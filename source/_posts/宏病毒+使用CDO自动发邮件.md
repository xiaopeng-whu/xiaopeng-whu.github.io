---
title: 宏病毒+使用CDO自动发邮件
date: 2020-10-12 11:33:34
tags: 宏病毒
categories: 软件安全
---
---
这周软件安全课介绍了下word文档宏的使用。在这之前我只在有些老师使用老版本的word时候，在上面会提示“是否启用宏”之类的信息，但对宏是什么其实并没有什么了解。
<!--more-->
上了一节课算是大概了解了一些基本知识。宏是一种批量处理，即将一系列操作转化为一个快捷命令，而宏病毒可以通过宏自动执行等方式来进行攻击，可以用VB来进行编写。

以一次课后作业来说明宏病毒的用法。

要求：
制作一个Word文档发送给另一个同学，当对方打开该文档时，你可以知道该文档在对方电脑存储的具体路径。
- 邮件组件：如CDO组件
- 远程脚本等。

其实这个任务难的是使用CDO自动发邮件

在VB中编写如下代码。（网上有不少代码，但很多我编译会出错，下面是一个可行的）
![](/宏病毒+使用CDO自动发邮件/1.png)
![](/宏病毒+使用CDO自动发邮件/1.png)

之前尝试用qq邮箱和163邮箱作为发送服务器，并且也设置了smtp开启，但就是有问题。后来又使用了我之前的gmail账号邮箱，但还是无法连接服务器。最后听舍友建议换了企业版的gmail邮箱，总算是成功发送了。但一开始没找到邮件，后来在垃圾箱找到了，原来邮件被默认为垃圾邮件了，手动恢复标记后算是成功获取了，得到了文档路径。

而其中获取文档所在路径的语句只有一个 ```ActiveDocument.Path```，所以大部分语句都是为了设置CDO组件的使用。

而且目前这种方法有缺陷，就是当校园网不稳定无法上google的时候，使用gmail邮箱作为server也会无法连接（应该是这个原因），甚至google能上了之后也要等半天才能恢复正常。但又找不到另一个可用的smtp服务开启并可用的邮箱，暂时先这样吧，日后再改进。
